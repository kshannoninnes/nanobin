@page "/"
@inject PasteService PasteService
@inject NavigationManager Navigation

<div class="create-paste">
    <div class="editor-container">
        <textarea @ref="PasteArea" class="paste-input" placeholder="Enter your text here..." @bind="_pasteContent"></textarea>
    </div>
    <button @onclick="SubmitAsync" class="create-button">Create Paste</button>
</div>

@code {
    private string _pasteContent = string.Empty;
    private ElementReference PasteArea { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender)
        {
            return;
        }

        try
        {
            // Fix for autofocus not working in blazor apps
            await PasteArea.FocusAsync();
        }
        catch (JSException e)
        {
            Console.WriteLine("Error focusing textarea: " + e.Message);
        }
    }

    private async Task SubmitAsync()
    {
        if (string.IsNullOrWhiteSpace(_pasteContent))
        {
            Console.WriteLine("Paste content cannot be empty.");
            return;
        }

        try
        {
            var pasteId = await PasteService.CreatePasteAsync(_pasteContent);
            Navigation.NavigateTo($"/{pasteId}");
        }
        catch (IOException e)
        {
            Console.WriteLine("Error creating paste: " + e.Message);
        }
    }
}